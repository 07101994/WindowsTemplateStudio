<Page x:Class="Microsoft.Templates.UI.Views.NewItem.ChangesSummaryView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:converters="clr-namespace:Microsoft.Templates.UI.Converters"
      xmlns:templateSelector="clr-namespace:Microsoft.Templates.UI.TemplateSelectors"
      mc:Ignorable="d" 
      d:DesignHeight="300" d:DesignWidth="300">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Microsoft.Templates.UI;component/Styles/UIStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

            <DataTemplate x:Key="ChangesSummaryExpanderHeaderTemplate">
                <TextBlock Text="{Binding}" Style="{StaticResource TextSummaryGroupHeader}"/>
            </DataTemplate>

            <DataTemplate x:Key="ListItemTemplate">
                <Grid Margin="{StaticResource SmallMargin}">
                    <TextBlock Text="{Binding Subject}" Style="{StaticResource NewItemFileNameStyle}"/>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="DefaultDetailTemplate">
                <ScrollViewer HorizontalScrollBarVisibility="Visible" VerticalScrollBarVisibility="Visible">
                    <ItemsControl ItemsSource="{Binding NewFileLines}" Margin="{StaticResource MediumMargin}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Line}" FontSize="{Binding FontSize}" Style="{StaticResource NewItemFileLineStyle}"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DataTemplate>

            <templateSelector:NewItemFileTemplateSelector
                x:Key="NewItemFileTemplateSelector"
                AddedFileTemplate="{StaticResource DefaultDetailTemplate}"
                ModifiedFileTemplate="{StaticResource DefaultDetailTemplate}"
                ConflictingFileTemplate="{StaticResource DefaultDetailTemplate}"
                WarningFileTemplate="{StaticResource DefaultDetailTemplate}"/>
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding ChangesSummary.FileGroups}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Expander
                            Margin="{StaticResource MediumTopMargin}"
                            Header="{Binding Name}"
                            HeaderTemplate="{StaticResource ChangesSummaryExpanderHeaderTemplate}"
                            IsExpanded="True"
                            BorderThickness="0"
                            Visibility="{Binding HasItems, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ListView
                                Focusable="False"
                                Style="{StaticResource ListViewChangesSummaryFiles}"                        
                                ItemTemplate="{StaticResource ListItemTemplate}"
                                ItemsSource="{Binding Templates}"
                                SelectedItem="{Binding SelectedItem, Mode=TwoWay}" />
                        </Expander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        <ContentPresenter
            Grid.Column="1"
            Content="{Binding ChangesSummary.SelectedFile}"
            ContentTemplateSelector="{StaticResource NewItemFileTemplateSelector}"/>
        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,21,21">
            <Button Content="+" Command="{Binding ChangesSummary.UpdateFontSizeCommand}" CommandParameter="Plus" Style="{StaticResource ButtonUpdateFontSizeStyle}" />
            <Button Content="-" Command="{Binding ChangesSummary.UpdateFontSizeCommand}" CommandParameter="Minus" Style="{StaticResource ButtonUpdateFontSizeStyle}" />
        </StackPanel>
    </Grid>
</Page>
